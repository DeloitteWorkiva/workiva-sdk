"""Platform API â€” graph namespace.

Auto-generated by codegen. Do not edit manually.
"""

from __future__ import annotations

from typing import Any, Literal, Optional

import httpx

from workiva._constants import _API
from workiva._operations._base import BaseNamespace
from workiva.models.platform import (
    EditsResult,
    Record,
    RecordsListResult,
    Type,
    TypesListResult,
)

__all__ = ["Graph"]


class Graph(BaseNamespace):
    """Graph operations."""

    _api: _API = _API.PLATFORM

    def create_edits(
        self,
        *,
        body: list[Any],
        timeout: Optional[float] = None,
    ) -> EditsResult:
        """Create new record edits

        Creates new record [edits](ref:graph#edit) given their properties. Each
        edit in the supplied array requires at least an `operation` and
        `targetId`. Up to 1000 edits may be processed per request.
        If there are invalid edits, the error details will include a list of
        errors encountered. Each message will include the zero-based position of
        the failed edit in the provided list of edits.

        Args:
            body: Request body.
            timeout: Override the default request timeout (seconds).

        Returns:
            EditsResult

        Raises:
            WorkivaAPIError: On API errors (400, 401, 403, 404, 409, 429, 500, 503).
        """
        response = self._client.request(
            "POST",
            self._api,
            "/graph/edits",
            json_body=body,
            timeout=timeout,
        )
        return EditsResult.model_validate(response.json())

    async def create_edits_async(
        self,
        *,
        body: list[Any],
        timeout: Optional[float] = None,
    ) -> EditsResult:
        """Create new record edits (async)

        Creates new record [edits](ref:graph#edit) given their properties. Each
        edit in the supplied array requires at least an `operation` and
        `targetId`. Up to 1000 edits may be processed per request.
        If there are invalid edits, the error details will include a list of
        errors encountered. Each message will include the zero-based position of
        the failed edit in the provided list of edits.

        Args:
            body: Request body.
            timeout: Override the default request timeout (seconds).

        Returns:
            EditsResult

        Raises:
            WorkivaAPIError: On API errors (400, 401, 403, 404, 409, 429, 500, 503).
        """
        response = await self._client.request_async(
            "POST",
            self._api,
            "/graph/edits",
            json_body=body,
            timeout=timeout,
        )
        return EditsResult.model_validate(response.json())

    def get_records(
        self,
        *,
        expand: Optional[str] = None,
        filter_: Optional[str] = None,
        timeout: Optional[float] = None,
    ) -> RecordsListResult:
        """Retrieve a list of records

        Returns a list of [records](ref:graph#record) matching the provided
        filters. At least one filter is required. If no filter is provided an
        error will be returned.

        Args:
            expand: Returns related resources inline with the main resource
            filter_: The properties to filter the results by.
            timeout: Override the default request timeout (seconds).

        Returns:
            RecordsListResult

        Raises:
            WorkivaAPIError: On API errors (400, 401, 403, 404, 409, 429, 500, 503).
        """
        response = self._client.request(
            "GET",
            self._api,
            "/graph/records",
            query_params={
                "$expand": expand,
                "$filter": filter_,
            },
            timeout=timeout,
        )
        return RecordsListResult.model_validate(response.json())

    async def get_records_async(
        self,
        *,
        expand: Optional[str] = None,
        filter_: Optional[str] = None,
        timeout: Optional[float] = None,
    ) -> RecordsListResult:
        """Retrieve a list of records (async)

        Returns a list of [records](ref:graph#record) matching the provided
        filters. At least one filter is required. If no filter is provided an
        error will be returned.

        Args:
            expand: Returns related resources inline with the main resource
            filter_: The properties to filter the results by.
            timeout: Override the default request timeout (seconds).

        Returns:
            RecordsListResult

        Raises:
            WorkivaAPIError: On API errors (400, 401, 403, 404, 409, 429, 500, 503).
        """
        response = await self._client.request_async(
            "GET",
            self._api,
            "/graph/records",
            query_params={
                "$expand": expand,
                "$filter": filter_,
            },
            timeout=timeout,
        )
        return RecordsListResult.model_validate(response.json())

    def get_record_by_id(
        self,
        *,
        record_id: str,
        expand: Optional[str] = None,
        timeout: Optional[float] = None,
    ) -> Record:
        """Retrieve a single record

        Retrieves a [record](ref:graph#record) given its ID. The unique
        identifier is typically a UUID, but it may be a different unique string
        in some cases.

        Args:
            record_id: The unique identifier of the record
            expand: Returns related resources inline with the main resource
            timeout: Override the default request timeout (seconds).

        Returns:
            Record

        Raises:
            WorkivaAPIError: On API errors (400, 401, 403, 404, 409, 429, 500, 503).
        """
        response = self._client.request(
            "GET",
            self._api,
            "/graph/records/{recordId}",
            path_params={
                "recordId": record_id,
            },
            query_params={
                "$expand": expand,
            },
            timeout=timeout,
        )
        return Record.model_validate(response.json())

    async def get_record_by_id_async(
        self,
        *,
        record_id: str,
        expand: Optional[str] = None,
        timeout: Optional[float] = None,
    ) -> Record:
        """Retrieve a single record (async)

        Retrieves a [record](ref:graph#record) given its ID. The unique
        identifier is typically a UUID, but it may be a different unique string
        in some cases.

        Args:
            record_id: The unique identifier of the record
            expand: Returns related resources inline with the main resource
            timeout: Override the default request timeout (seconds).

        Returns:
            Record

        Raises:
            WorkivaAPIError: On API errors (400, 401, 403, 404, 409, 429, 500, 503).
        """
        response = await self._client.request_async(
            "GET",
            self._api,
            "/graph/records/{recordId}",
            path_params={
                "recordId": record_id,
            },
            query_params={
                "$expand": expand,
            },
            timeout=timeout,
        )
        return Record.model_validate(response.json())

    def graph_report_export(
        self,
        *,
        report_id: str,
        format_: Literal["csv"],
        timeout: Optional[float] = None,
    ) -> httpx.Response:
        """Initiate a graph report export

        Asynchronously exports a graph report (only CSV available at this time).
        This endpoint will execute the query of a saved report and export to the
        specified format (only CSV available at this time). The ID of the
        [record](ref:graph#record) containing the saved report is used for the
        `reportID` path element. Reports are stored in records of type
        `DataSource` and `ReportView`. The list of applicable records can be
        retrieved from the `/records` endpoint such as `GET
        /records?$filter=type eq DataSource or type eq ReportView`. A filter on
        the `title` property should be used to return a particular report.
        Responses include a `Location` header, which indicates where to poll for
        export results. For more details on long-running job polling, see
        [Operations endpoint](ref:getoperationbyid). When the export completes,
        its status will be `completed`, and the response body includes a
        `resourceURL`. To download the exported file, perform a GET on the
        `resourceURL` with the same authentication credentials and flow as the
        export request. For more details, see [Authentication
        documentation](ref:authentication).

        Args:
            report_id: The unique identifier of the report
            format_: The format to export the graph report to - curently, only .CSV
            timeout: Override the default request timeout (seconds).

        Raises:
            WorkivaAPIError: On API errors (400, 401, 403, 404, 409, 429, 500, 503).

        Note:
            This is a long-running operation (HTTP 202). Use
            ``client.wait(response).result()`` to poll until completion.
        """
        _body: dict[str, Any] = {}
        if format_ is not None:
            _body["format"] = format_
        return self._client.request(
            "POST",
            self._api,
            "/graph/reports/{reportId}/export",
            path_params={
                "reportId": report_id,
            },
            json_body=_body or None,
            timeout=timeout,
        )

    async def graph_report_export_async(
        self,
        *,
        report_id: str,
        format_: Literal["csv"],
        timeout: Optional[float] = None,
    ) -> httpx.Response:
        """Initiate a graph report export (async)

        Asynchronously exports a graph report (only CSV available at this time).
        This endpoint will execute the query of a saved report and export to the
        specified format (only CSV available at this time). The ID of the
        [record](ref:graph#record) containing the saved report is used for the
        `reportID` path element. Reports are stored in records of type
        `DataSource` and `ReportView`. The list of applicable records can be
        retrieved from the `/records` endpoint such as `GET
        /records?$filter=type eq DataSource or type eq ReportView`. A filter on
        the `title` property should be used to return a particular report.
        Responses include a `Location` header, which indicates where to poll for
        export results. For more details on long-running job polling, see
        [Operations endpoint](ref:getoperationbyid). When the export completes,
        its status will be `completed`, and the response body includes a
        `resourceURL`. To download the exported file, perform a GET on the
        `resourceURL` with the same authentication credentials and flow as the
        export request. For more details, see [Authentication
        documentation](ref:authentication).

        Args:
            report_id: The unique identifier of the report
            format_: The format to export the graph report to - curently, only .CSV
            timeout: Override the default request timeout (seconds).

        Raises:
            WorkivaAPIError: On API errors (400, 401, 403, 404, 409, 429, 500, 503).

        Note:
            This is a long-running operation (HTTP 202). Use
            ``await client.wait(response).result_async()`` to poll until completion.
        """
        _body: dict[str, Any] = {}
        if format_ is not None:
            _body["format"] = format_
        return await self._client.request_async(
            "POST",
            self._api,
            "/graph/reports/{reportId}/export",
            path_params={
                "reportId": report_id,
            },
            json_body=_body or None,
            timeout=timeout,
        )

    def get_types(
        self,
        *,
        expand: Optional[str] = None,
        timeout: Optional[float] = None,
    ) -> TypesListResult:
        """Retrieve a list of types

        The Types endpoint is used to discover what [types](ref:graph#type) of
        records exist and their attributes. This endpoint lets you know what to
        expect from the Records endpoints.

        Args:
            expand: Returns related resources inline with the main resource
            timeout: Override the default request timeout (seconds).

        Returns:
            TypesListResult

        Raises:
            WorkivaAPIError: On API errors (400, 401, 403, 404, 409, 429, 500, 503).
        """
        response = self._client.request(
            "GET",
            self._api,
            "/graph/types",
            query_params={
                "$expand": expand,
            },
            timeout=timeout,
        )
        return TypesListResult.model_validate(response.json())

    async def get_types_async(
        self,
        *,
        expand: Optional[str] = None,
        timeout: Optional[float] = None,
    ) -> TypesListResult:
        """Retrieve a list of types (async)

        The Types endpoint is used to discover what [types](ref:graph#type) of
        records exist and their attributes. This endpoint lets you know what to
        expect from the Records endpoints.

        Args:
            expand: Returns related resources inline with the main resource
            timeout: Override the default request timeout (seconds).

        Returns:
            TypesListResult

        Raises:
            WorkivaAPIError: On API errors (400, 401, 403, 404, 409, 429, 500, 503).
        """
        response = await self._client.request_async(
            "GET",
            self._api,
            "/graph/types",
            query_params={
                "$expand": expand,
            },
            timeout=timeout,
        )
        return TypesListResult.model_validate(response.json())

    def get_type_by_id(
        self,
        *,
        type_id: str,
        expand: Optional[str] = None,
        timeout: Optional[float] = None,
    ) -> Type:
        """Retrieve a single type

        Returns a record [type](ref:graph#type) given its ID (name)

        Args:
            type_id: The unique identifier of the type
            expand: Returns related resources inline with the main resource
            timeout: Override the default request timeout (seconds).

        Returns:
            Type

        Raises:
            WorkivaAPIError: On API errors (400, 401, 403, 404, 409, 429, 500, 503).
        """
        response = self._client.request(
            "GET",
            self._api,
            "/graph/types/{typeId}",
            path_params={
                "typeId": type_id,
            },
            query_params={
                "$expand": expand,
            },
            timeout=timeout,
        )
        return Type.model_validate(response.json())

    async def get_type_by_id_async(
        self,
        *,
        type_id: str,
        expand: Optional[str] = None,
        timeout: Optional[float] = None,
    ) -> Type:
        """Retrieve a single type (async)

        Returns a record [type](ref:graph#type) given its ID (name)

        Args:
            type_id: The unique identifier of the type
            expand: Returns related resources inline with the main resource
            timeout: Override the default request timeout (seconds).

        Returns:
            Type

        Raises:
            WorkivaAPIError: On API errors (400, 401, 403, 404, 409, 429, 500, 503).
        """
        response = await self._client.request_async(
            "GET",
            self._api,
            "/graph/types/{typeId}",
            path_params={
                "typeId": type_id,
            },
            query_params={
                "$expand": expand,
            },
            timeout=timeout,
        )
        return Type.model_validate(response.json())
