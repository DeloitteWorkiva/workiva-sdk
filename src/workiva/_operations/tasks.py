"""Platform API â€” tasks namespace.

Auto-generated by codegen. Do not edit manually.
"""

from __future__ import annotations

from typing import Any, Optional

import httpx

from workiva._constants import _API
from workiva._operations._base import BaseNamespace
from workiva._pagination import (
    extract_next_link,
    paginate_all,
    paginate_all_async,
)
from workiva.models.platform import (
    Task,
    TaskAction,
    TasksListResult,
)

__all__ = ["Tasks"]


class Tasks(BaseNamespace):
    """Tasks operations."""

    _api: _API = _API.PLATFORM

    def get_tasks(
        self,
        *,
        filter_: Optional[str] = None,
        order_by: Optional[str] = None,
        maxpagesize: Optional[int] = 1000,
        timeout: Optional[float] = None,
    ) -> TasksListResult:
        """Retrieve a list of tasks

        > Returns a paginated list of [tasks](ref:tasks#task). Currently this
        endpoint returns general tasks
        (such as those created as part of editing documents, sheets, and
        presentations) and tasks that have been associated  with a
        Sustainability Program.
        It does not return tasks created as part of a process.

        Args:
            filter_: The properties to filter the results by.
            order_by: One or more comma-separated expressions to indicate the order in which to sort the results.
            maxpagesize: The maximum number of results to retrieve
            timeout: Override the default request timeout (seconds).

        Returns:
            TasksListResult

        Raises:
            WorkivaAPIError: On API errors (400, 401, 403, 404, 409, 429, 500, 503).
        """

        def _fetch(_cursor: str | None) -> httpx.Response:
            return self._client.request(
                "GET",
                self._api,
                "/tasks",
                query_params={
                    "$filter": filter_,
                    "$orderBy": order_by,
                    "$maxpagesize": maxpagesize,
                    "$next": _cursor,
                },
                timeout=timeout,
            )

        _body = paginate_all(_fetch, extract_next_link, "data")
        return TasksListResult.model_validate(_body)

    async def get_tasks_async(
        self,
        *,
        filter_: Optional[str] = None,
        order_by: Optional[str] = None,
        maxpagesize: Optional[int] = 1000,
        timeout: Optional[float] = None,
    ) -> TasksListResult:
        """Retrieve a list of tasks (async)

        > Returns a paginated list of [tasks](ref:tasks#task). Currently this
        endpoint returns general tasks
        (such as those created as part of editing documents, sheets, and
        presentations) and tasks that have been associated  with a
        Sustainability Program.
        It does not return tasks created as part of a process.

        Args:
            filter_: The properties to filter the results by.
            order_by: One or more comma-separated expressions to indicate the order in which to sort the results.
            maxpagesize: The maximum number of results to retrieve
            timeout: Override the default request timeout (seconds).

        Returns:
            TasksListResult

        Raises:
            WorkivaAPIError: On API errors (400, 401, 403, 404, 409, 429, 500, 503).
        """

        async def _fetch(_cursor: str | None) -> httpx.Response:
            return await self._client.request_async(
                "GET",
                self._api,
                "/tasks",
                query_params={
                    "$filter": filter_,
                    "$orderBy": order_by,
                    "$maxpagesize": maxpagesize,
                    "$next": _cursor,
                },
                timeout=timeout,
            )

        _body = await paginate_all_async(_fetch, extract_next_link, "data")
        return TasksListResult.model_validate(_body)

    def create_task(
        self,
        *,
        body: Task,
        timeout: Optional[float] = None,
    ) -> Task:
        """Create a new task

        Creates a new [task](ref:tasks#task) given its properties.

        Returns:
            Task

        Raises:
            WorkivaAPIError: On API errors (400, 401, 403, 404, 409, 429, 500, 503).
        """
        response = self._client.request(
            "POST",
            self._api,
            "/tasks",
            json_body=body,
            timeout=timeout,
        )
        return Task.model_validate(response.json())

    async def create_task_async(
        self,
        *,
        body: Task,
        timeout: Optional[float] = None,
    ) -> Task:
        """Create a new task (async)

        Creates a new [task](ref:tasks#task) given its properties.

        Returns:
            Task

        Raises:
            WorkivaAPIError: On API errors (400, 401, 403, 404, 409, 429, 500, 503).
        """
        response = await self._client.request_async(
            "POST",
            self._api,
            "/tasks",
            json_body=body,
            timeout=timeout,
        )
        return Task.model_validate(response.json())

    def partially_update_task_by_id(
        self,
        *,
        task_id: str,
        body: list[Any],
        timeout: Optional[float] = None,
    ) -> Task:
        """Partially update a single task

        Partially updates the properties of a [task](ref:tasks#task).
        Please note: Tasks are automatically restarted when the following
        properties are updated:
        - `assignees`
        - `approvalSteps`: If any `participants` who have already approved are
        updated, the task will be restarted.
        - `location`
        ### Options
        |Path|PATCH Operations Supported|
        |---|---|
        |`/approvalSteps`|`replace`|
        |`/assignees`|`replace`|
        |`/description`|`replace`|
        |`/dueDate`|`replace`|
        |`/location`|`replace`|
        |`/owner`|`replace`|
        |`/title`|`replace`|

        Args:
            task_id: The unique identifier of the task
            body: Request body.
            timeout: Override the default request timeout (seconds).

        Returns:
            Task

        Raises:
            WorkivaAPIError: On API errors (400, 401, 403, 404, 409, 429, 500, 503).
        """
        response = self._client.request(
            "PATCH",
            self._api,
            "/tasks/{taskId}",
            path_params={
                "taskId": task_id,
            },
            json_body=body,
            timeout=timeout,
        )
        return Task.model_validate(response.json())

    async def partially_update_task_by_id_async(
        self,
        *,
        task_id: str,
        body: list[Any],
        timeout: Optional[float] = None,
    ) -> Task:
        """Partially update a single task (async)

        Partially updates the properties of a [task](ref:tasks#task).
        Please note: Tasks are automatically restarted when the following
        properties are updated:
        - `assignees`
        - `approvalSteps`: If any `participants` who have already approved are
        updated, the task will be restarted.
        - `location`
        ### Options
        |Path|PATCH Operations Supported|
        |---|---|
        |`/approvalSteps`|`replace`|
        |`/assignees`|`replace`|
        |`/description`|`replace`|
        |`/dueDate`|`replace`|
        |`/location`|`replace`|
        |`/owner`|`replace`|
        |`/title`|`replace`|

        Args:
            task_id: The unique identifier of the task
            body: Request body.
            timeout: Override the default request timeout (seconds).

        Returns:
            Task

        Raises:
            WorkivaAPIError: On API errors (400, 401, 403, 404, 409, 429, 500, 503).
        """
        response = await self._client.request_async(
            "PATCH",
            self._api,
            "/tasks/{taskId}",
            path_params={
                "taskId": task_id,
            },
            json_body=body,
            timeout=timeout,
        )
        return Task.model_validate(response.json())

    def get_task_by_id(
        self,
        *,
        task_id: str,
        timeout: Optional[float] = None,
    ) -> Task:
        """Retrieve a single task

        Retrieves a [task](ref:tasks#task) given its ID

        Args:
            task_id: The unique identifier of the task
            timeout: Override the default request timeout (seconds).

        Returns:
            Task

        Raises:
            WorkivaAPIError: On API errors (400, 401, 403, 404, 409, 429, 500, 503).
        """
        response = self._client.request(
            "GET",
            self._api,
            "/tasks/{taskId}",
            path_params={
                "taskId": task_id,
            },
            timeout=timeout,
        )
        return Task.model_validate(response.json())

    async def get_task_by_id_async(
        self,
        *,
        task_id: str,
        timeout: Optional[float] = None,
    ) -> Task:
        """Retrieve a single task (async)

        Retrieves a [task](ref:tasks#task) given its ID

        Args:
            task_id: The unique identifier of the task
            timeout: Override the default request timeout (seconds).

        Returns:
            Task

        Raises:
            WorkivaAPIError: On API errors (400, 401, 403, 404, 409, 429, 500, 503).
        """
        response = await self._client.request_async(
            "GET",
            self._api,
            "/tasks/{taskId}",
            path_params={
                "taskId": task_id,
            },
            timeout=timeout,
        )
        return Task.model_validate(response.json())

    def delete_task_by_id(
        self,
        *,
        task_id: str,
        timeout: Optional[float] = None,
    ) -> httpx.Response:
        """Delete a single task

        Deletes a [task](ref:tasks#task) given its ID

        Args:
            task_id: The unique identifier of the task
            timeout: Override the default request timeout (seconds).

        Raises:
            WorkivaAPIError: On API errors (400, 401, 403, 404, 409, 429, 500, 503).
        """
        return self._client.request(
            "DELETE",
            self._api,
            "/tasks/{taskId}",
            path_params={
                "taskId": task_id,
            },
            timeout=timeout,
        )

    async def delete_task_by_id_async(
        self,
        *,
        task_id: str,
        timeout: Optional[float] = None,
    ) -> httpx.Response:
        """Delete a single task (async)

        Deletes a [task](ref:tasks#task) given its ID

        Args:
            task_id: The unique identifier of the task
            timeout: Override the default request timeout (seconds).

        Raises:
            WorkivaAPIError: On API errors (400, 401, 403, 404, 409, 429, 500, 503).
        """
        return await self._client.request_async(
            "DELETE",
            self._api,
            "/tasks/{taskId}",
            path_params={
                "taskId": task_id,
            },
            timeout=timeout,
        )

    def submit_task_action(
        self,
        *,
        task_id: str,
        body: TaskAction,
        timeout: Optional[float] = None,
    ) -> Task:
        """Initiate a task action submission

        This endpoint enables submitting actions on a [task](ref:tasks#task).
        For tasks with multiple approval steps, it's the only way to advance a
        task through the approval process.

        Args:
            task_id: The unique identifier of the task
            body: Request body.
            timeout: Override the default request timeout (seconds).

        Returns:
            Task

        Raises:
            WorkivaAPIError: On API errors (400, 401, 403, 404, 409, 429, 500, 503).
        """
        response = self._client.request(
            "POST",
            self._api,
            "/tasks/{taskId}/actionSubmission",
            path_params={
                "taskId": task_id,
            },
            json_body=body,
            timeout=timeout,
        )
        return Task.model_validate(response.json())

    async def submit_task_action_async(
        self,
        *,
        task_id: str,
        body: TaskAction,
        timeout: Optional[float] = None,
    ) -> Task:
        """Initiate a task action submission (async)

        This endpoint enables submitting actions on a [task](ref:tasks#task).
        For tasks with multiple approval steps, it's the only way to advance a
        task through the approval process.

        Args:
            task_id: The unique identifier of the task
            body: Request body.
            timeout: Override the default request timeout (seconds).

        Returns:
            Task

        Raises:
            WorkivaAPIError: On API errors (400, 401, 403, 404, 409, 429, 500, 503).
        """
        response = await self._client.request_async(
            "POST",
            self._api,
            "/tasks/{taskId}/actionSubmission",
            path_params={
                "taskId": task_id,
            },
            json_body=body,
            timeout=timeout,
        )
        return Task.model_validate(response.json())
